{
  "id": "rescue_hiccup_toothless",
  "title": "Rescue Hiccup and Toothless",
  "description": "Hiccup and Toothless crashed into the woods. You must save them and bring them home safely.",
  "variables": {
    "target": ""
  },
  "characters": {
    "hiccup": {
      "acquireLock": 2
    },
    "toothless": {
      "acquireLock": 2
    },
    "astrid": {
      "acquireLock": 1
    }
  },
  "hiccup_death_msg": "Hiccup was lost in the forest after the crash.",
  "toothless_death_msg": "Toothless perished in the woods, unable to escape the dangers.",
  "astrid_death_msg": null,
  "start_state": "travel_to_crash",
  "start_entity": "character:hiccup",
  "start_line": "Are you making a new tailfin for Toothless? Can I see it in action?",
  "start_condition": "True",
  "states": {
    "travel_to_crash": {
      "steps": [
        {
          "type": "story",
          "text": "Hiccup swiftly hops onto Toothless. Their eyes widen, as if they are one. Hiccup asks you for the last time"
        },
        {
          "type": "dialogue",
          "speaker": "hiccup",
          "text": "You sure you don't want to go?"
        },
        {
          "type": "story",
          "text": "You know you actually do, but he's probably going to need help, and you're the only one who knows what he's up to now, so you stay put just in case"
        },
        {
          "type": "dialogue",
          "speaker": "hiccup",
          "text": "Well, I'll see you later!"
        },
        {
          "type": "story",
          "text": "Not long after, you hear a thud. A roar ensues. Not just any roar, but Toothless's roar. You sense him agonized."
        },
        {
          "type": "dialogue",
          "speaker": "astrid",
          "text": "Hey {player_name}! Did Hiccup just went out, again? I heard his roar from the woods. Please, I need your help to save him!"
        },
        {
          "type": "story",
          "text": "The forest looms dark and tangled. You and Astrid must reach Hiccup and Toothless before danger strikes."
        },
        {
          "type": "dialogue",
          "speaker": "astrid",
          "text": "We need to move quickly but carefully.",
          "choices": [
            {
              "text": "Move cautiously",
              "retrospective": {
                "line": "Let's take it easy.",
                "type": "dialogue"
              },
              "effect": "quest_target='rescue_hiccup'"
            },
            {
              "text": "Rush recklessly",
              "retrospective": {
                "line": "Come on! We don't know how long they'll last!",
                "type": "dialogue"
              },
              "effect": "quest_target='rescue_hiccup_reckless'"
            }
          ]
        }
      ],
      "transitions": [
        {
          "condition": "quest_target=='rescue_hiccup'",
          "target": "rescue_hiccup"
        },
        {
          "condition": "quest_target=='rescue_hiccup_reckless'",
          "target": "rescue_hiccup_reckless"
        }
      ]
    },
    "rescue_hiccup": {
      "steps": [
        {
          "type": "story",
          "text": "You arrive at the crash site. Toothless is panicked, Hiccup trapped under a heavy branch."
        },
        {
          "type": "stateUpdate",
          "update": "hiccup_health -= 10\ntoothless_health -= 5\ndragon_bonding_level += 5"
        }
      ],
      "transitions": [
        {
          "condition": "hiccup_health<=0 or toothless_health<=0",
          "target": "quest_failed"
        },
        {
          "condition": "hiccup_health>0 and toothless_health>0",
          "target": "lift_branch"
        }
      ]
    },
    "rescue_hiccup_reckless": {
      "steps": [
        {
          "type": "story",
          "text": "You charge in blindly. Toothless panics, Hiccup's branch snaps violently."
        },
        {
          "type": "stateUpdate",
          "update": "hiccup_health -= 95\ntoothless_health -= 95\nplayer_health -= 30\ndragon_bonding_level -= 20"
        }
      ],
      "transitions": [
        {
          "condition": "hiccup_health<=0 or toothless_health<=0",
          "target": "quest_failed"
        },
        {
          "condition": "hiccup_health>0 and toothless_health>0",
          "target": "lift_branch"
        }
      ]
    },
    "lift_branch": {
      "steps": [
        {
          "type": "story",
          "text": "Toothless hesitates as you prepare to free him. The wind is picking up, and the branch creaks ominously."
        },
        {
          "type": "dialogue",
          "speaker": "astrid",
          "text": "Careful! One slip and they could fall!"
        },
        {
          "type": "dialogue",
          "speaker": "hiccup",
          "text": "Aaah! Oh my back hurts.... Please help me!",
          "choices": [
            {
              "text": "Lift slowly, ensure stability.",
              "retrospective": {
                "line": "I slowly lifted the branch. Although Hiccup shrieked as the weight shifted the branch mostly remains intact",
                "type": "story"
              },
              "effect": "dragon_bonding_level += 2\ntoothless_dominance -= 1\nhiccup_health -= 3"
            },
            {
              "text": "Lift quickly so it hurts less.",
              "retrospective": {
                "line": "I threw the branch out of the way with all my power. Hiccup takes a deep breath of relief, but Toothless roars in pain as the branch breaks apart and crashes upon him.",
                "type": "story"
              },
              "effect": "toothless_health -= 10\nhiccup_trust += 1"
            }
          ]
        }
      ],
      "transitions": [
        {
          "condition": "hiccup_health<=0 or toothless_health<=0",
          "target": "quest_failed"
        },
        {
          "condition": "hiccup_health>0 and toothless_health>0",
          "target": "return_home"
        }
      ]
    },
    "return_home": {
      "steps": [
        {
          "type": "story",
          "text": "With Hiccup freed and Toothless calm, you start the journey back to the village. The forest creaks and rustles around you. Cliffs and holes await your journey back."
        },
        {
          "type": "dialogue",
          "speaker": "hiccup",
          "text": "Thank you so much for saving us! Let's head back, it's getting cold, fast!",
          "choices": [
            {
              "text": "Move cautiously",
              "effect": "quest_target='quest_complete'"
            },
            {
              "text": "Hurry to finish",
              "effect": "quest_target='return_home_hazard'"
            }
          ]
        }
      ],
      "transitions": [
        {
          "condition": "quest_target=='quest_complete'",
          "target": "quest_complete"
        },
        {
          "condition": "quest_target=='return_home_hazard'",
          "target": "return_home_hazard"
        }
      ]
    },
    "return_home_hazard": {
      "steps": [
        {
          "type": "dialogue",
          "speaker": "hiccup",
          "text": "Okay, let's go back quickly, then."
        },
        {
          "type": "dialogue",
          "speaker": "astrid",
          "text": "Hiccup! Wait!"
        },
        {
          "type": "story",
          "text": "A tight turn looms ahead. As Hiccup runs towards you, his peg leg creates a distinct slipping sound."
        },
        {
          "type": "dialogue",
          "speaker": "hiccup",
          "text": "Hang on {character_name}, I'm coming! Oh no. TOOTHLESS! HEEELLLPPP!"
        },
        {
          "type": "story",
          "text": "In your rush, Toothless stumbles and Hiccup nearly falls from a cliff. You barely reached his arm in time."
        },
        {
          "type": "stateUpdate",
          "update": "hiccup_health -= 20\ntoothless_health -= 15\nplayer_health -= 10\ndragon_bonding_level -= 5"
        }
      ],
      "transitions": [
        {
          "condition": "hiccup_health<=0 or toothless_health<=0",
          "target": "quest_failed"
        },
        {
          "condition": "hiccup_health>0 and toothless_health>0",
          "target": "quest_complete"
        }
      ]
    },
    "quest_failed": {
      "steps": [
        {
          "type": "story",
          "text": "Despite your best intentions. Hiccup and Toothless did not survive the forest's dangers. Astrid looks at you with sorrow, anger, and disappointment. Berk will never forget the loss of its proud young chief."
        },
        {
          "type": "stateUpdate",
          "update": "quest_status = 'failed'\nhiccup_death_msg = 'Hiccup crashed while testing his tailfin, and is lost forever in the woods.'\ntoothless_death_msg = 'Toothless was trapped in the woods, and perished from its hostility.'\nastrid_trust -= 5"
        }
      ],
      "transitions": []
    },
    "quest_complete": {
      "steps": [
        {
          "type": "story",
          "text": "You escort Hiccup and Toothless safely back to the village. Toothless nuzzles you gratefully... with a little too much force! Astrid stands in the corner, giving a gentle smile for your success."
        },
        {
          "type": "stateUpdate",
          "update": "quest_status = 'completed'\nastrid_trust += 2\ntoothless_bonding_level += 3\nhiccup_trust += 3"
        }
      ],
      "transitions": []
    }
  }
}